<!doctype html>
<html>
  <head>
    {% include head.liquid %}

    <!-- Distill js -->
    <script src="{{ '/assets/js/distillpub/template.v2.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/distillpub/transforms.v2.js' | relative_url }}"></script>
    {% if page._styles %}
      <!-- Page/Post style -->
      <style type="text/css">
        {{ page._styles }}
      </style>
    {% endif %}
    {% if page.toc and page.toc.sidebar %}
      <!-- Override Distill grid to match post layout -->
      <style type="text/css">
        .distillpost .post.distill {
          display: block !important;
        }
        .distillpost d-title,
        .distillpost d-byline,
        .distillpost d-article,
        .distillpost d-appendix {
          display: block !important;
          grid-column: unset !important;
        }
        .distillpost d-article > * {
          grid-column: unset !important;
        }
      </style>
    {% endif %}
  </head>

  <d-front-matter>
    <script async type="text/json">
      {
            "title": "{{ page.title }}",
            "description": "{{ page.description }}",
            "published": "{{ page.date | date: '%B %d, %Y' }}",
            "authors": [
              {% for author in page.authors %}
              {
                "author": "{{ author.name }}",
                "authorURL": "{{ author.url }}",
                "affiliations": [
                  {
                    "name": "{{ author.affiliations.name }}",
                    "url": "{{ author.affiliations.url }}"
                  }
                ]
              }{% if forloop.last == false %},{% endif %}
              {% endfor %}
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script>
  </d-front-matter>

  <body class="{% if site.navbar_fixed %}fixed-top-nav{% endif %} {% unless site.footer_fixed %}sticky-bottom-footer{% endunless %}">
    <!-- Header -->
    {% include header.liquid %}

    <!-- Content -->
    <div class="container mt-5{% if page.toc and page.toc.sidebar %} distillpost{% endif %}" role="main">
    {% if page.toc and page.toc.sidebar %}
      <div class="row">
        {% if page.toc.sidebar == 'left' %}
        <div class="col-sm-3">
          <nav id="toc-sidebar" class="sticky-top"></nav>
        </div>
        {% endif %}
        <div class="col-sm-9">
    {% endif %}
    <div class="post distill">
      {% assign year = page.date | date: '%Y' %}
      {% assign tags = page.tags | join: '' %}
      {% assign categories = page.categories | join: '' %}
      {% assign url_beginning = page.url | slice: 0, 6 %}

      <d-title>
        <h1>{{ page.title }}</h1>
        <p>{{ page.description }}</p>
      </d-title>
      {% if page.authors %}
        <d-byline></d-byline>
      {% endif %}

      {% if tags != '' or categories != '' %}
        <p class="post-tags" style="margin-top: 0.5rem; margin-bottom: 1rem;">
          {% if url_beginning == '/blog/' %}
            <a href="{{ year | prepend: '/blog/' | relative_url }}"><i class="fa-solid fa-calendar fa-sm"></i> {{ year }}</a>
          {% else %}
            <i class="fa-solid fa-calendar fa-sm"></i> {{ year }}
          {% endif %}
          {% if tags != '' %}
            &nbsp; &middot; &nbsp;
            {% for tag in page.tags %}
              {% if url_beginning == '/blog/' %}
                <a href="{{ tag | slugify | prepend: '/blog/tag/' | relative_url }}"><i class="fa-solid fa-hashtag fa-sm"></i> {{ tag }}</a>
              {% else %}
                <i class="fa-solid fa-hashtag fa-sm"></i> {{ tag }}
              {% endif %}
              {% unless forloop.last %}&nbsp;{% endunless %}
            {% endfor %}
          {% endif %}
          {% if categories != '' %}
            &nbsp; &middot; &nbsp;
            {% for category in page.categories %}
              {% if url_beginning == '/blog/' %}
                <a href="{{ category | slugify | prepend: '/blog/category/' | relative_url }}"><i class="fa-solid fa-tag fa-sm"></i> {{ category }}</a>
              {% else %}
                <i class="fa-solid fa-tag fa-sm"></i> {{ category }}
              {% endif %}
              {% unless forloop.last %}&nbsp;{% endunless %}
            {% endfor %}
          {% endif %}
        </p>
      {% endif %}

      <d-article>
        {% unless page.toc.sidebar %}
        {% if page.toc and page.toc.size > 0 %}
          <d-contents>
            <nav class="l-text figcaption">
              <h3>Contents</h3>
              {% for section in page.toc %}
                <div>
                  <a href="#{{ section.name | slugify }}">{{ section.name }}</a>
                </div>
                {% if section.subsections %}
                  <ul>
                    {% for subsection in section.subsections %}
                      <li>
                        <a href="#{{ subsection.name | slugify }}">{{ subsection.name }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              {% endfor %}
            </nav>
          </d-contents>

        {% elsif page.toc == true %}
          <d-contents>
            <nav class="l-text figcaption">
              <h3>Contents</h3>
              {% toc %}
            </nav>
          </d-contents>
        {% endif %}
        {% endunless %}

        {{ content }}
      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      <d-bibliography src="{{ page.bibliography | prepend: '/assets/bibliography/' | relative_url }}"></d-bibliography>

      <d-article>
        {% if site.related_blog_posts and site.related_blog_posts.enabled %}
          {% if page.related_posts == null or page.related_posts %}
            {% include related_posts.liquid %}
          {% endif %}
        {% endif %}
        <br>
        <br>
        {% if site.disqus_shortname and page.disqus_comments %}{% include disqus.liquid %}{% endif %}
        {% if site.giscus.repo and page.giscus_comments %}
          {% include giscus.liquid %}
        {% endif %}
      </d-article>
    </div>
    {% if page.toc and page.toc.sidebar %}
        </div>
        {% if page.toc.sidebar == 'right' %}
        <div class="col-sm-3">
          <nav id="toc-sidebar" class="sticky-top"></nav>
        </div>
        {% endif %}
      </div>
    {% endif %}
    </div>

    <!-- Footer -->
    {% include footer.liquid %}

    <!-- JavaScripts -->
    {% include distill_scripts.liquid %}
  </body>
</html>
